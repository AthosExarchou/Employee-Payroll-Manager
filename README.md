# Employee Payroll Manager

A robust COBOL application that parses CSV employee records, converts text fields to numeric values, performs arithmetic using COMP-3 BCD fields, validates input, calculates pay totals, and produces a fixed-width payroll report. Includes error logging and supports customizable input/output filenames.

---

## Table of Contents

- [Overview](#overview)
- [Input File Format](#input-file-format)
- [Output File](#output-file)
- [System Requirements](#system-requirements)
- [Setup Instructions](#setup-instructions)
- [Running the Program](#running-the-program)
- [Command-Line Usage](#command-line-usage)
- [Generating Large Input Files](#generating-large-input-files)
- [File Structure](#file-structure)
- [Troubleshooting](#troubleshooting)
- [Notes](#notes)
- [Author](#author)
- [License](#license)

---

## Overview

The program:

1. Reads employee records from a CSV file.
2. Converts text fields to numeric values.
3. Calculates each employee's pay (`Hours * Rate`).
4. Generates a formatted payroll report with totals.

This version handles fixed-width fields internally for proper alignment in the report and validates numeric input.

---

## Input File Format

The program expects a **CSV file** named `employees.csv` with the following columns:

`EMP-ID,NAME,HOURS,RATE`

Example:

```text
0001,Alex Hill,33,38.99
0002,Veronica Rice,34,32.94
...
1000,Joseph Dunn,42,11.64
```

- `EMP-ID`: 4-digit integer.
- `NAME`: Full name (up to 20 characters is recommended for alignment).
- `HOURS`: Integer hours worked.
- `RATE`: Decimal hourly rate (e.g., 15.50).

> **Note**: The program validates numeric fields using `NUMVAL`. Fields with invalid characters, multiple decimal points, or missing values will be logged in `error.log`.

---

## Output File

The program generates a file named `report.txt` with the following format:

```text
================================================
  Payroll Report - Generated by Athos Exarchou
                Date: 2025-09-11
================================================
ID   NAME                  HRS   RATE     PAY
------------------------------------------------
0001 Alex Hill             33    38.99    1286.6
0002 Veronica Rice         34    32.94    1119.9
...
1000 Joseph Dunn           42    11.64     488.8
------------------------------------------------
TOTAL PAY:                              138644.3
================================================
```

[Download Sample Payroll Report](report.txt)

- Dynamically generated date.
- Properly aligned columns for readability.
- Total pay calculated at the bottom.

> **Tip**: Adjust column widths in the COBOL source code if you expect names longer than 20 characters.

### Error Logging

Invalid or malformed records are written to `error.log` in the format:
```text
YYYY-MM-DD - Error message - RAW: CSV line
```

---

### Numeric Fields

| Field        | PIC Format     | Description                  |
|--------------|----------------|------------------------------|
| WS-EMP-HOURS | 9(3)           | Integer hours worked         |
| WS-RATE      | 9(3)V99        | Decimal hourly rate          |
| WS-PAY       | 9(6)V99 COMP-3 | Computed pay (Hours × Rate)  |
| WS-TOTAL-PAY | 9(7)V99 COMP-3 | Sum of all employee pays     |

- `WS-PAY` and `WS-TOTAL-PAY` use `COMP-3` (packed decimal) for efficient arithmetic on large datasets.

---

## System Requirements

- Ubuntu/Debian or Linux system
- GnuCOBOL (`cobc` compiler)
- Python 3.x (optional, for generating fake employee data)

---

## Setup Instructions

### 1. Install GnuCOBOL

```bash
sudo apt update
sudo apt install open-cobol
```

Check installation:
```bash
cobc -v
```

### 2. Prepare Input File

Place your `employees.csv` in the same directory as `payroll.cob`.

## Running the Program

Compile:
```bash
cobc -x payroll.cob
```

Execute:
```bash
./payroll
```

The report will be generated as `report.txt`. Errors will be logged to `error.log`.

---

## Command-Line Usage

The program can prompt for input/output files:

```text
Enter input file name (default: employees.csv):
Enter output report file name (default: report.txt):
```
Press Enter to accept defaults. You can also specify alternative CSV or report names.

---

## Generating Large Input Files

To generate many fake employees, use Python with a virtual environment:

```bash
# Create virtual environment
python3 -m venv COBOLenv

# Activate virtual environment
source COBOLenv/bin/activate

# Install Faker
pip install faker

# Run script to generate employees
python generate_employees.py

# Deactivate when done
deactivate
```

Example `generate_employees.py`:

```python
# imports
import random
import csv
from faker import Faker

fake = Faker()

num_employees = 1000
output_file = "employees.csv"

with open(output_file, mode="w", newline="") as file:
    writer = csv.writer(file)
    for emp_id in range(1, num_employees + 1):
        name = fake.name()
        hours = random.randint(30, 45) # typical work hours
        rate = round(random.uniform(10, 50), 2) # hourly rate between 10 and 50
        writer.writerow([f"{emp_id:04d}", name, hours, f"{rate:.2f}"])

print(f"{num_employees} demo employees written to {output_file}")

```

---

## File Structure

```text
Employee-Payroll-Manager/
├─ payroll.cob           # COBOL source code
├─ employees.csv         # CSV input file
├─ report.txt            # Generated payroll report
├─ generate_employees.py # Optional Python script for test data
├─ error.log             # Automatically generated error log
├─ .gitignore            # Ignore compiled binaries, temporary files, logs, and generated reports
├─ Makefile              # Build and run instructions for COBOL program
└─ README.md             # Project documentation
```

---

## Troubleshooting

- **NUMVAL issues / PAY calculation wrong**: Make sure the `employees.csv` has valid numeric values and no extra spaces in `HOURS` or `RATE`.
- **GnuCOBOL compile errors**: Verify your numeric fields are correctly defined (`PIC 9(3)V99` for decimals).
- **Python pip errors on Ubuntu/Debian**: Use a virtual environment (venv) instead of installing system-wide.

## Notes

- The program uses `UNSTRING` to split CSV lines into fields.
- Decimal math is handled using COBOL `V` format (`9(3)V99`) and optionally `COMP-3` for large totals.
- `error.log` captures malformed or invalid employee records.
- Column widths can be adjusted in the COBOL source code to accommodate longer names or larger numeric values (update WS-EMP-NAME-TEXT PIC X(20) and the corresponding column in the report layout).
- Designed for readability and fixed-width formatting in the report.

## Author

- **Name**: Exarchou Athos
- **Student ID**: it2022134
- **Email**: it2022134@hua.gr, athosexarhou@gmail.com

## License
This project is licensed under the MIT License.
